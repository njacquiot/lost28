<html>
<head>

<style>

	#useVerb { width:15%; float: right; }
	#useNoun { width:20%; float: right; }
	#Score { width:20%; float: right; }
	#form { width:40%; float: left; }

</style>

<script src="/jquery.min.js"></script>

<script>

$(document).ready( function() {
	$.getJSON( "/data.json", function(data) {

		//Game is on
		let gameIsRunning = true;

		let storage = [
		  {
		    "world": "",
		    "rooms": "",
		    "score" : 0,
				"name" : "",
				"wand1" : [
					"not find",
					0
				],
				"wand2" : [
					"not find",
					0
				],
				"box" : [
					"not find",
					0,
					"close"
				],
				"key" : [
					"notfind",
					"lock",
					0
				],
				"book" : [
					"notfind",
					0
				],
				"painting" : "not find",
				"boggart" : "lock",
				"light_switch" : "not find",
				"light" : "off",
		  }
		];


			$('#end').hide();
			let text = JSON.stringify(storage);
			localStorage.setItem('mystorage', text);
			let mystorage = JSON.parse(localStorage.getItem('mystorage'));
			console.log(mystorage);

			for(i = 0; i<data[1].verbs.length; i++){
				$('#useVerb').append("<li>"+data[1].verbs[i]+"</li>");
			}

			for(i = 0; i<data[1].nouns.length; i++){
				$('#useNoun').append("<li>"+data[1].nouns[i]+"</li>");
			}

			$('#Score').html("<p><b>Your Score</b></p></br></br><b>"+ mystorage[0].score +"</b>");



			//One world and a random room to start
			$('#status').append( 'Your are in ' + data[0].world + ' world');


			// Save string to localStorage
			mystorage[0].world = data[0].world;

			let rand = Math.floor(Math.random()*3);
			mystorage[0].rooms = data[0].rooms[2]; //TT le temps Poudlard pour l'instant
			localStorage.setItem('mystorage', JSON.stringify(mystorage));
			$('#status').append('</br></br>You are now in the room ' + mystorage[0].rooms);


				//Confirm your character
				$('#enterBtn').click( ()=>{
					mystorage[0].name = $('#userName').val().toUpperCase();
					localStorage.setItem('mystorage', JSON.stringify(mystorage));
					$('#character').html('Welcome to ' +  mystorage[0].rooms + " " + mystorage[0].name);
					$('#instructions').show();
				});

				$('#userName').keyup(  function(e){
					if (e.keyCode == 13){
						mystorage[0].name = $('#userName').val().toUpperCase();
						localStorage.setItem('mystorage', JSON.stringify(mystorage));
						$('#character').html('Welcome to ' +  mystorage[0].rooms + " " + mystorage[0].name);
						$('#instructions').show();


					}
				});

				$('#understand').click( ()=>{

					$('#understand').hide();

					$("#dumbledore").append("Hello " + mystorage[0].name + ", I'm Dumbledore nice to meet you. " + mystorage[0].rooms + " is a huge place, hope you won't be lost ! How can I help you ?");
					$('#questions').show();

					$("#send").click( ()=>{

						$([document.documentElement, document.body]).animate({
				        scrollTop: $("#send").offset().top
				    }, 2000);

						switch ($('#Verb').val().toUpperCase()) {


							case data[1].verbs[0]: //describe
								$('#game').append("</br></br>Well, I will tell you what I see !");
								switch ($('#Noun').val().toUpperCase()) {
									case data[1].nouns[0]:
										if(mystorage[0].light == "on"){
											mystorage[0].score += 100;
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
											$('#Score').html("<p><b>Your Score</b></p></br></br><b>"+ mystorage[0].score +"</b>");
											$('#game').append(data[2].Poudlard_description[1]);
										}else{
											$('#game').append(data[2].Poudlard_description[0]);
										}
										break;
									case data[1].nouns[1]:
									if (mystorage[0].wand == 1){
										$('#game').append(data[2].Wand_description[1]);
									}else	if (mystorage[0].wand == 2){
										$('#game').append(data[2].Wand_description[2]);
									}else{
										$('#game').append("</br></br>I don't know if there is a wand here ...");
									}
										break;
									case data[1].nouns[2]:
										if(mystorage[0].box[0] == "find"){
											$('#game').append(data[2].Box);
										}else{
											$('#game').append("</br></br>I don't know where the box is. I have to find it");
										}
										break;
									case data[1].nouns[3]:
										if(mystorage[0].key[1] == "unlock"){
											$('#game').append(data[2].Key);
										}else{
											$('#game').append("</br></br>I don't know where the key is. I have to find it");
										}
										break;
									case data[1].nouns[4]:
											if(mystorage[0].box[0] == "find"){
												$('#game').append(data[2].Door);
											}else{
												$('#game').append("</br></br>There is no door");
											}
										break;
									case data[1].nouns[5]:
											$('#game').append(data[2].Book[0]);
										break;
									case data[1].nouns[6]:
											$('#game').append(data[2].Light);
										break;
									case data[1].nouns[7]:
											$('#game').append(data[2].Painting);
										break;
									default:
										$('#game').append("</br></br>Sorry I don't undestand what you want");

								}
								break;


							case data[1].verbs[1]: //Say
								switch ($('#Noun').val().toUpperCase()) {
									case "ALOHOMORA":
										if(mystorage[0].box[1] == 1 && (mystorage[0].wand1[1] == 1||mystorage[0].wand2[1] == 1)){
												$('#game').append("</br></br>Wow it works you have open the box... OMG this is a... a Boggart, you have to fight ! Hope you know how to win");
												mystorage[0].boggart = "unlock";
												mystorage[0].score += 100;
												$('#Score').html("<p><b>Your Score</b></p></br></br><b>"+ mystorage[0].score +"</b>");
												localStorage.setItem('mystorage', JSON.stringify(mystorage));
										}else{
												$('#game').append("</br></br>"+$('#Noun').val() + "Mmmh nothing happened you don't have a wand");
										}
										break;
									case "RIDICULOUS":
										if (mystorage[0].boggart == "unlock"){
											mystorage[0].score += 500;
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
											$('#Score').html("<p><b>Your Score</b></p></br></br><b>"+ mystorage[0].score +"</b>");
											$('#game').append("</br></br>Ahahahaha It's a clown now :D Oh he gives you a key, you should take it");
											mystorage[0].key[1] = "unlock";
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
										}else{
												$('#game').append($('#Noun').val().toUpperCase() + " Mmmh nothing happened");
										}
										break;
									default :
									if(mystorage[0].painting == "find"){
										$('#game').append(data[2].Lockhart);
										$('#game').append("</br></br><b>You unlock the new Verb ACCIO</b>");
										$('#useVerb').append("<li>ACCIO</li>");
									} else {
										$('#game').append("</br></br>"+$('#Noun').val().toUpperCase());
									}
								}
								break;

							case "ACCIO" :
								let best_rand = Math.floor(Math.random()*2);
								console.log(best_rand);
								switch ($('#Noun').val().toUpperCase()) {
									case data[1].nouns[1]: //Wand

										if(best_rand == 1){
											mystorage[0].score += 200;
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
											$('#Score').html("<p><b>Your Score</b></p></br></br><b>"+ mystorage[0].score +"</b>");
											$('#game').append("</br></br>Oh interesting you are really lucky I found a " + $('#Noun').val() + " You should take it !!");
											let rand2 = Math.floor(Math.random());
											if(rand2 == 0){
												mystorage[0].wand1[0] = "find";
											}else{
												mystorage[0].wand2[0] = "find";
											}
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
											//localStorage.setItem("Wand", rand);
											$('#game').append(data[2].Wand_description[rand2]);
										}else{
											$('#game').append("</br></br>Sorry I didn't find any wand");
										}
										break;
										default:
											$('#game').append("</br></br>Sorry I can't do that");
								}
								break;



							case data[1].verbs[2]: //take
								switch ($('#Noun').val().toUpperCase()) {

									case data[1].nouns[1] : //wand
										if(	mystorage[0].wand1[0] == "find"){
											mystorage[0].wand1[1] = 1;
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
											$('#game').append("</br></br>Alright I took the "+ $('#Noun').val() + ", you can use it whenever you want");
										}else if(mystorage[0].wand2[0] == "find"){
											mystorage[0].wand2[1] = 1;
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
											//localStorage.setItem("Mywand", "wand");
											$('#game').append("</br></br>Alright I took the "+ $('#Noun').val() + ", you can use it whenever you want");
										}else{
											$('#game').append("</br></br>I don't know if there is a wand here ...");
										}
									break;
									case data[1].nouns[2]: //Box
										if(mystorage[0].box[0] == "find"){
											mystorage[0].box[1] = 1;
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
											$('#game').append("</br></br>Alright I took the "+ $('#Noun').val() + ", you can use it whenever you want");
										}else{
											$('#game').append("</br></br>I don't know where the box is .. ");
										}
										break;
									case data[1].nouns[3]: //KEY
										if(mystorage[0].key[1] == "unlock"){
											$('#game').append("</br></br>Alright I took the "+ $('#Noun').val() + ", you can use it whenever you want");
											mystorage[0].score += 50;
											$('#Score').html("<p><b>Your Score</b></p></br></br><b>"+ mystorage[0].score +"</b>");
											mystorage[0].key[2] = 1;
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
										}else{
											$('#game').append("</br></br>I don't know where the key is .. ");
										}
										break;

									case data[1].nouns[5]: //The books
										if(mystorage[0].book[0] == "find"){
											mystorage[0].score += 10;
											mystorage[0].book[1] = 1;
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
											$('#Score').html("<p><b>Your Score</b></p></br></br><b>"+ mystorage[0].score +"</b>");
											$('#game').append("</br></br>Alright I took the "+ $('#Noun').val() + ", you can use it whenever you want");
										}else{
											$('#game').append("</br></br>You need to find it before");
										}
										break;
									}
								break;


							case data[1].verbs[3]: //open
								switch ($('#Noun').val().toUpperCase()) {

									case data[1].nouns[2]: //Box
										if(mystorage[0].box[1] == 1){
											mystorage[0].box[2] = "open";
											mystorage[0].score += 50;
											$('#Score').html("<p><b>Your Score</b></p></br></br><b>"+ mystorage[0].score +"</b>");
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
											$('#game').append("</br></br>The " + $('#Noun').val() + " is close.. I think tou need to find a speel to open it, and I hope you have a wand");
										}else{
											$('#game').append("</br></br>You don't have any Box in your objects");
										}
										break;

									case data[1].nouns[4]: //The DOOR
										if (mystorage[0].key[2] == 1){

											mystorage[0].score += 1000;
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
											$('#Score').html("<p><b>Your Score</b></p></br></br><b>"+ mystorage[0].score +"</b>");
											$('#game').append("</br></br><b>You did it !!!! Congratulation you figure out how to leave the room, see you in another world :)</b>");
											$('#send').hide();
											$('#Noun').hide();
											$('#Verb').hide();
											$('#end').show();
											$('#end').click( ()=>{
												$('#Ongame').hide();
												$('#endGame').append(("<b>I LOVE YOU SARAH<b>"));
												$('#endGame').append(("</br></br>Here is your final score : "+ mystorage[0].score));
												gameIsRunning = false;
											});
										}else{
											$('#game').append("</br></br>The door is locked");
										}
										break;
								}


								break;


							case data[1].verbs[4]: //find

								let rand = Math.floor(Math.random()*4);
								switch ($('#Noun').val().toUpperCase()) {
									case data[1].nouns[1]: //Wand
										if(rand == 1){
											mystorage[0].score += 100;
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
											$('#Score').html("<p><b>Your Score</b></p></br></br><b>"+ mystorage[0].score +"</b>");
											$('#game').append("</br></br>Oh interesting you are really lucky I found a " + $('#Noun').val() + " You should take it !!");
											let rand = Math.floor(Math.random());
											if(rand == 0){
												mystorage[0].wand1[0] = "find";
											}else{
												mystorage[0].wand2[0] = "find";
											}
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
											//localStorage.setItem("Wand", rand);
											$('#game').append(data[2].Wand_description[rand]);
										}else{
											$('#game').append("</br></br>Sorry I didn't find any wand");
										}
										break;
									case data[1].nouns[2]: //Box
										if (mystorage[0].light == "on"){
											mystorage[0].box[0] = "find";
											mystorage[0].score += 10;
											$('#Score').html("<p><b>Your Score</b></p></br></br><b>"+ mystorage[0].score +"</b>");
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
											$('#game').append("</br></br>Oh interesting I found a " + $('#Noun').val()+ " You should take it !!");
										}else{
											$('#game').append("</br></br>Sorry I don't see any "+ $('#Noun').val());
										}
										break;

									case data[1].nouns[4]: //The DOOR
										if (mystorage[0].light == "on"){
											$('#game').append("</br></br>The door is in the end of the room");
										}else{
											$('#game').append("</br></br>There is no issues");
										}
										break;

									case data[1].nouns[5]: //The books
											$('#game').append(data[2].Book[1]);
											mystorage[0].book[0] = "find"
											mystorage[0].score += 10;
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
											$('#Score').html("<p><b>Your Score</b></p></br></br><b>"+ mystorage[0].score +"</b>");
											$('#game').append("</br></br>It seeems to be a good idea to take it");
										break;

									case data[1].nouns[7]: //Painting
										mystorage[0].score += 10;
										mystorage[0].painting = "find";
										localStorage.setItem('mystorage', JSON.stringify(mystorage));
										$('#Score').html("<p><b>Your Score</b></p></br></br><b>"+ mystorage[0].score +"</b>");
										$('#game').append("</br></br>I'm in front of the painting do you want to say something ?");
										break;

									case data[1].nouns[8]: //Light switch
										mystorage[0].light_switch = "find";
										mystorage[0].score += 10;
										$('#Score').html("<p><b>Your Score</b></p></br></br><b>"+ mystorage[0].score +"</b>");
										localStorage.setItem('mystorage', JSON.stringify(mystorage));
										//localStorage.setItem('Light_switch', 'find');
										$('#game').append("</br></br>Oh interesting you are really lucky I found the " + $('#Noun').val());
										break;
									default:
										$('#game').append("</br></br>Sorry I don't undestand your noun");

								}
								break;


							case data[1].verbs[5]: //read
								switch ($('#Noun').val().toUpperCase()) {
									case data[1].nouns[5]:
									if(mystorage[0].book[1] == 1){
										mystorage[0].book[1] = 2;
										mystorage[0].score += 50;
										localStorage.setItem('mystorage', JSON.stringify(mystorage));
										$('#Score').html("<p><b>Your Score</b></p></br></br><b>"+ mystorage[0].score +"</b>");
										$('#game').append("</br></br>One second, I took my glasses... It says : " + data[2].Book[2]);
										$('#game').append("</br></br><b>You unlock two new nouns : ALOHOMORA and RIDICULOUS</b>");
										$('#useNoun').append("<li>ALOHOMORA</li>");
										$('#useNoun').append("<li>RIDICULOUS</li>");
									}else{
										$('#game').append("</br></br>Sorry but you don't have any book in your objects");
									}
										break;
								default :
									$('#game').append("</br></br>Sorry I don't undestand your sentence");
								}
								break;

							case data[1].verbs[6]: //switch on
								switch ($('#Noun').val().toUpperCase()) {
									case data[1].nouns[6]:
										if(mystorage[0].light_switch == "find"){
											mystorage[0].light = "on";
											mystorage[0].score += 100;
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
											$('#Score').html("<p><b>Your Score</b></p></br></br><b>"+ mystorage[0].score +"</b>");
											$('#game').append("</br></br>Perfect I see correctly now !");
										}else{
												$('#game').append('</br></br>Sorry but I don\'t know where the light switch is ... ');
										}
										break;
									default :
										$('#game').append("</br></br>Sorry I don't undestand your sentence");
									}
								break;



							case data[1].verbs[7]: //switch off
								switch ($('#Noun').val().toUpperCase()) {
									case data[1].nouns[6]:
										if(mystorage[0].light_switch == "find"){
											mystorage[0].light = "off";
											localStorage.setItem('mystorage', JSON.stringify(mystorage));
											$('#game').append("</br></br>Oh we don't see anything now !");
										}else{
												$('#game').append('</br></br>Sorry but I don\'t know where the light is ... ');
										}
										break;
										default:
											$('#game').append("</br></br>Sorry I don't undestand your sentence");
								}
							default:
								$('#game').append("</br></br>Sorry I don't undestand your sentence");

						}

					$('#Verb').val('');
					$('#Noun').val('');

					});


				});





	});
});

</script>

<title>Lost Game</title>
<style>

</style>


</head>
<body>

	<div id = "Ongame">

		<div id = "useNoun">
			<p>Nouns understandable by Dumbledore</p>
		</div>

		<div id = "useVerb">
			<p>Verbs understandable by Dumbledore</p>
		</div>

		<div id = "Score"></div>

			<h1>Lost Game</h1>

		    <p>Welcome to the game</p>
				<div id ="status"></div>

			<div id = "character">
				<p>You can now enter your name</p>
				<input type="text" id="userName"></input>
				<button type="button" id="enterBtn">ENTER</button>
			</div>
			<div id ="instructions"  style="display: none">

			</br></br></br></br>The game can start !! Instructions are simple : </br></br></br></br>
		<p>	You are in one room of the game but there are other places and you have to undestand how you can go out ! </br></br>The goal is to understand your room in order to leave, the more you understand the more points you will have !! </br></br>
			You can talk to Dumbledore with a simple combinaison of a <b>Noun</b> and a <b>Verb</b> that he can understand, Enjoy :)</br></br></p>
		<button type="button" id="understand">UNDERSTAND</button>



			</div>

			<div id ="dumbledore"></div>

			<div id = "Poudlard">

				<div id = "room">

				</div>

			</div>

			<div id = "form">
				<div id ="game"></div>
				<div id = "questions" style="display: none">
				<input id ="Verb" type ="text" placeholder="Verb"/>
				<input id ="Noun" type="text" placeholder="Noun"/>
				<button id ="send">Send</button>
				<button id ="end">Finish</button>
				</div>
			</div>



		</div>

		<div id ="endGame">

		</div>




</body>
</html>
